# Глава 9. Динамическое программирование

## Задача о рюкзаке

**Условие**

У вас есть рюкзак, в котором можно унести товары общим весом до 4 фунтов.

Есть три предмета, которые можно уложить в рюкзак:

Предмет|Цена|Вес
-|-|-
Магнитофон|3000|4
Ноутбук|2000|3
Гитара|1500|1

Какие предметы следует положить в рюкзак, чтобы стоимость добычи была максимальной?

**Простое решение**

Перебор всех возможных множеств предметов - O(2<sup>n</sup>).

**Приближенное решение**

Неоптимальное решение с помощью жадного алгоритма (берем самое дорогое, что влезает).

**Оптимальное решение**

Динамическое программирование.

## Динамическое программирование

> Процедура начинается с решения подзадач с по­ степенным переходом к решению полной задачи.
>
> В задаче о рюкзаке начать следует с реше­ния задачи для меньшего рюкзака (или подрюкзака), а потом на этой основе попытаться решить исходную задачу.

Начинаем с таблицы, в которой каждый предмет представлен отдельной строкой. В качестве столбцов - размеры "подрюкзаков" в фунтах.

Фунты|1|2|3|4
-|-|-|-|-
Гитара||||
Магнитофон||||
Ноутбук||||

[Заполнение таблицы и зачем это нужно](./fill-table.md)

Для заполнения каждой ячейки существует формула:

```
cell[row][col] = max(
  //предыдущий max
  cell[row - 1][col],

  // стоимость текущего элемента
  // + стоимость оставшегося пространства
  cell[row - 1][col - вес предмета]
)
```

```
npm run knapsack
```

## Оптимизация туристического маршрута

**Условие**

Представьте, что вы приехали в Лондон на выходные. У вас два дня, а мест, которые хочется посетить, слишком много. Побывать везде не получится, поэтому вы составляете список.

Достопримечательность|Время|Оценка
-|-|-
Вестминстерское аббатство|0.5 дня|7
Театр Глобус|0.5 дня|6
Национальная галерея|1 день|9
Британский музей|2 дня|9
Собор святого Павла|0.5 дня|8

[Заполнение таблицы](./route-table.md)

***

* Динамическое программирование применяется для оптимизации какой-либо характеристики при заданных ограничениях. В задаче о рюкзаке требуется максимизи­ ровать стоимость отобранных предметов с ограничениями по емкости рюкзака.
* Динамическое программирование работает только в ситуациях, в кото­рых задача может быть разбита на автономные подзадачи, не зависящие друг от друга.

Несколько общих рекомендаций:

* в каждом решении из области динамического программирования стро­ится таблица;
* значения ячеек таблицы обычно соответствуют оптимизируемой ха­рактеристике. Для задачи о рюкзаке значения представляли общую стоимость товаров;
* каждая ячейка представляет подзадачу, поэтому вы должны подумать о том, как разбить задачу на подзадачи. Это поможет вам определиться с осями.

## Самая длинная общая подстрока

Найдем самую длинную общую подстроку (символы идут по порядку) для слов FISH и HISH.

Сравниваем первую букву F поочередно с каждой буквой слова HISH. Совпадений нет, так что везде нули.

-|H|I|S|H
-|-|-|-|-
F|0|0|0|0
I|-|-|-|-
S|-|-|-|-
H|-|-|-|-

Переходим ко второй букве I. Есть совпадение со второй буквой слова HISH. Ставим единицу.

-|H|I|S|H
-|-|-|-|-
F|0|0|0|0
I|0|1|0|0
S|-|-|-|-
H|-|-|-|-

Буква S. Совпадает с третьей буквой слова. Слева по диагонали уже стоит единица, значит, предыдущие буквы слов тоже совпали, поэтому сюда поставим двойку.

-|H|I|S|H
-|-|-|-|-
F|0|0|0|0
I|0|1|0|0
S|0|0|2|0
H|-|-|-|-

Аналогично с последней буквой:

-|H|I|S|H
-|-|-|-|-
F|0|0|0|0
I|0|1|0|0
S|0|0|2|0
H|0|0|0|3

Ответом будет самая большая цифра в таблице (необязательно в последнем ряду). У нас это 3.

```
npm run max-subscring
```

## Самая длинная общая подпоследовательность

В подпоследовательности совпадающие символы необязательно должны стоять рядом, главное, чтобы в слове они шли друг за другом.

Найдем наибольшую общую подпоследовательность для слов fosh и fort.

Отмечаем совпадение первой буквы.

-|F|O|S|H
-|-|-|-|-
F|1|0|0|0
O|-|-|-|-
R|-|-|-|-
T|-|-|-|-

Но теперь при несовпадении вместо нуля берем большее значение сверху или слева, так как прогресс сбрасывать не нужно.

-|F|O|S|H
-|-|-|-|-
F|1|0|0|0
O|1|2|2|2
R|1|2|2|2
T|1|2|2|2

Ответом будет последняя ячейка последнего ряда.

```
npm run max-subsequence
```

## Шпаргалка

* Динамическое программирование применяется при оптимизации не­которой характеристики.
* Динамическое программирование работает только в ситуациях, в кото­рых задача может быть разбита на автономные подзадачи.
* В каждом решении из области динамического программирования стро­ится таблица.
* Значения ячеек таблицы обычно соответствуют оптимизируемой харак­ теристике.
* Каждая ячейка представляет подзадачу, поэтому вы должны подумать о том, как разбить задачу на подзадачи.
* Не существует единой формулы для вычисления решений методом ди­намического программирования.